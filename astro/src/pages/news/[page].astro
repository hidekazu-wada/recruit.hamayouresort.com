---
import MySiteLayout from '@layouts/MySiteLayout.astro';
import LowerPageHeader from '@components/common/LowerPageHeader.astro';
import NewsList from '@components/news/NewsList.astro';
import Pagination from '@components/common/Pagination.astro';
import { getCollection } from 'astro:content';

const POSTS_PER_PAGE = 10;
const { page } = Astro.params;
const currentPage = Number(page);

const allPosts = (await getCollection('news')).sort(
  (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

const totalPages = Math.ceil(allPosts.length / POSTS_PER_PAGE);
const start = (currentPage - 1) * POSTS_PER_PAGE;
const end = start + POSTS_PER_PAGE;
const posts = allPosts.slice(start, end);

export async function getStaticPaths() {
  const allPosts = await getCollection('news');
  const totalPages = Math.ceil(allPosts.length / POSTS_PER_PAGE);
  return Array.from({ length: totalPages }, (_, i) => ({
    params: { page: String(i + 1) },
  }));
}
---

<MySiteLayout>
  <LowerPageHeader pageTitleEn="News" pageTitleJa="お知らせ" />
  <NewsList posts={posts} />
  <Pagination
    currentPage={currentPage}
    totalPages={totalPages}
    baseUrl="/news/page"
  />
</MySiteLayout>
