---
import HeroDesktop from '@assets/images/top-hero-desktop.png';
import HeroTablet from '@assets/images/top-hero-tablet.png';
import HeroMobil from '@assets/images/top-hero-mobile.png';
import { Image } from 'astro:assets';
import WaveDecoration from '@components/common/WaveDecoration.astro';
---

<section id="hero">
  <h1 class="hero-catchcopy">
    本気<span>で</span>遊べ<span>ば、</span><br />仕事<span>になる</span>
  </h1>

  <picture>
    <!-- デスクトップ用（1024px以上） -->
    <source
      srcset={HeroDesktop.src}
      media="(min-width: 1024px)"
      width={HeroDesktop.width}
      height={HeroDesktop.height}
    />
    <!-- タブレット用（744px以上1024px未満） -->
    <source
      srcset={HeroTablet.src}
      media="(min-width: 744px)"
      width={HeroTablet.width}
      height={HeroTablet.height}
    />
    <!-- モバイル用（デフォルト） -->
    <Image
      src={HeroMobil}
      alt="トップページのヒーロー画像"
      format="webp"
      class="hero-image"
    />
  </picture>

  <div class="btn-wrapper">
    <a href="/new-graduate" class="item">
      <span class="btn-text">新卒で挑戦</span>
    </a>
    <a href="/mid-career" class="item">
      <span class="btn-text">中途で経験を活かす</span>
    </a>
    <a href="/arbeit" class="item">
      <span class="btn-text">空いてる日にバイト</span>
    </a>
  </div>

  <WaveDecoration fillColor="#E7F3F9" />

  <!-- GSAP CDN -->
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"
  ></script>
  <!-- アニメーション制御 -->
  <script is:inline>
    window.addEventListener('DOMContentLoaded', () => {
      const hero = document.querySelector('.hero-catchcopy');
      if (!hero) return;

      function wrapChars(node) {
        if (node.nodeType === Node.TEXT_NODE) {
          const chars = node.textContent.split('');
          return chars.map((char) => {
            const span = document.createElement('span');
            span.textContent = char;
            span.classList.add('char');
            return span;
          });
        } else if (node.nodeType === Node.ELEMENT_NODE) {
          // <br>はそのまま返す
          if (node.nodeName === 'BR') {
            return [node.cloneNode(false)];
          }
          const newElem = node.cloneNode(false);
          node.childNodes.forEach((child) => {
            wrapChars(child).forEach((c) => newElem.appendChild(c));
          });
          return [newElem];
        }
        return [];
      }

      const nodes = Array.from(hero.childNodes);
      hero.textContent = '';
      nodes.forEach((node) => {
        wrapChars(node).forEach((c) => hero.appendChild(c));
      });

      gsap.set('.char', { opacity: 0, y: 20 });
      gsap.to('.char', {
        opacity: 1,
        y: 0,
        stagger: 0.07,
        duration: 0.5,
        ease: 'power2.out',
        onComplete: () => {
          gsap.to('.btn-wrapper', {
            opacity: 1,
            x: 0,
            duration: 0.7,
            ease: 'power2.out',
          });
        },
      });
      gsap.set('.btn-wrapper', { opacity: 0, x: 60 });
    });
  </script>
</section>

<style lang="scss">
  @import '@styles/functions.scss';
  @import '@styles/mixins.scss';

  section#hero {
    position: relative;

    h1 {
      color: #fff;
      text-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);
      font-size: spx(60);
      font-weight: 900;
      line-height: spx(84);
      letter-spacing: spx(3);
      position: absolute;
      top: spx(90);
      left: spx(30);

      @include tablet-up {
        font-size: spx(60) * 0.75;
        line-height: spx(84) * 0.75;
        letter-spacing: spx(3) * 0.75;
        top: spx(90) * 0.75;
        left: spx(30) * 0.75;
      }

      @include desktop-up {
        font-size: ppx(120);
        line-height: ppx(168);
        top: ppx(107);
        left: ppx(21);
      }
      span,
      .char {
        color: #fff;
        font-size: spx(34);
        font-weight: 900;
        line-height: 140%;
        letter-spacing: spx(1.7);

        @include tablet-up {
          font-size: spx(34) * 0.75;
          letter-spacing: spx(1.7) * 0.75;
        }

        @include desktop-up {
          font-size: ppx(50);
        }
      }
    }

    picture {
      img {
        width: 100%;
        height: auto;
      }
    }

    .btn-wrapper {
      position: absolute;
      left: 0;
      bottom: spx(88);
      display: flex;
      flex-flow: column;
      gap: spx(20);
      opacity: 0;
      transform: translateX(60px);
      @include tablet-up {
        bottom: spx(88) * 0.75;
        gap: spx(20) * 0.75;
      }
      @include desktop-up {
        left: unset;
        right: 0;
        bottom: ppx(112);
        gap: ppx(20);
      }
      .item {
        display: block;
        width: spx(220);
        height: spx(47);
        display: grid;
        place-items: center;
        border: 1px solid rgba(255, 255, 255, 0.9);
        background: linear-gradient(
          93deg,
          rgba(255, 255, 255, 0.8) 0.01%,
          rgba(255, 255, 255, 0.6) 99.99%
        );
        box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.12);
        backdrop-filter: blur(35px);
        text-decoration: none;

        @include tablet-up {
          width: spx(220) * 0.75;
          height: spx(47) * 0.75;
        }

        @include desktop-up {
          width: ppx(220);
          height: ppx(47);
        }

        .btn-text {
          font-size: spx(16);
          font-weight: 500;
          line-height: 100%;
          letter-spacing: spx(1.92);

          @include tablet-up {
            font-size: spx(16) * 0.75;
            letter-spacing: spx(1.92) * 0.75;
          }

          @include desktop-up {
            font-size: ppx(18);
            letter-spacing: ppx(2.16);
          }
        }
      }
    }
  }
</style>
